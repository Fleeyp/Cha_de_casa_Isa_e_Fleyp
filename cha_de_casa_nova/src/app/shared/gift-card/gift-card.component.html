<div class="gift-card" [class.reserved]="gift.purchased">
  <div class="card-header">
    <div class="icon-container">
      <svg class="gift-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <rect x="3" y="8" width="18" height="13" rx="2"/>
        <path d="M12 8V21"/>
        <path d="M3 13h18"/>
        <path d="M12 8c-2-3-6-3-6 0s4 0 6 0c2-3 6-3 6 0s-4 0-6 0"/>
      </svg>
    </div>
    <div class="gift-info">
      <h3 class="gift-name">{{ gift.name }}</h3>
      <span class="gift-category">{{ gift.category }}</span>
    </div>
  </div>

  <p class="gift-description">{{ gift.description }}</p>

  <p class="gift-price">{{ formatPrice(gift.price) }}</p>

  <!-- Store Links Dropdown -->
  <div class="dropdown-container" (clickOutside)="closeDropdown()">
    <button class="dropdown-trigger" (click)="toggleDropdown()">
      <svg class="external-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
        <polyline points="15,3 21,3 21,9"/>
        <line x1="10" y1="14" x2="21" y2="3"/>
      </svg>
      <span>Ver onde comprar ({{ gift.links.length }} lojas)</span>
      <svg 
        class="chevron-icon" 
        [class.rotated]="isDropdownOpen"
        viewBox="0 0 24 24" 
        fill="none" 
        stroke="currentColor" 
        stroke-width="2"
      >
        <polyline points="6,9 12,15 18,9"/>
      </svg>
    </button>

    @if (isDropdownOpen) {
      <div class="dropdown-menu">
        @for (link of gift.links; track link.store) {
          <a [href]="link.url" target="_blank" rel="noopener noreferrer" class="dropdown-item">
            {{ link.store }}
            <svg class="link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
              <polyline points="15,3 21,3 21,9"/>
              <line x1="10" y1="14" x2="21" y2="3"/>
            </svg>
          </a>
        }
      </div>
    }
  </div>

  <button 
    class="reserve-button" 
    [class.reserved]="gift.purchased"
    (click)="onReserve()"
  >
    {{ gift.purchased ? 'Cancelar Reserva' : 'Reservar Presente' }}
  </button>
</div>
